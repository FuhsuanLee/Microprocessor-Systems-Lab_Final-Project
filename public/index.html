<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Smart Home Control</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #ffffff;
            color: #111;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #f5f5f5;
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        h1 { margin: 0; font-weight: 400; }
        header button {
            padding: 10px 20px;
            background-color: #555;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        header button:active { transform: scale(0.98); }
        main { padding: 30px; max-width: 600px; margin: auto; }
        section { margin-bottom: 30px; }
        section h2 {
            margin-bottom: 15px;
            font-weight: 500;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .buttons { display: flex; flex-wrap: wrap; gap: 10px; }
        button.action-btn {
            flex: 1 1 45%;
            padding: 12px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: 0.2s;
        }
        button.action-btn:active { transform: scale(0.98); }
        .led-on { background-color: #333; color: #fff; }
        .led-off { background-color: #bbb; color: #111; }
        .door-open { background-color: #4CAF50; color: #fff; flex: 1 1 100%; }
        .door-close { background-color: #f44336; color: #fff; flex: 1 1 100%; }
    </style>
</head>
<body>

<header>
    <h1>Smart Home Control</h1>
    <button onclick="goApprove()">授權</button>
</header>

<main>
    <!-- LED 控制 -->
    <section>
        <h2>LED 控制</h2>
        <div class="buttons">
            <button class="action-btn led-on" onclick="ledOn(0)">LED1 ON</button>
            <button class="action-btn led-off" onclick="ledOff(0)">LED1 OFF</button>
            <button class="action-btn led-on" onclick="ledOn(1)">LED2 ON</button>
            <button class="action-btn led-off" onclick="ledOff(1)">LED2 OFF</button>
            <button class="action-btn led-on" onclick="ledOn(2)">LED3 ON</button>
            <button class="action-btn led-off" onclick="ledOff(2)">LED3 OFF</button>
            <button class="action-btn led-on" onclick="ledOn(3)">LED4 ON</button>
            <button class="action-btn led-off" onclick="ledOff(3)">LED4 OFF</button>
        </div>
    </section>

    <!-- 門控 -->
    <section>
        <h2>門控</h2>
        <div class="buttons">
            <button class="action-btn door-open" onclick="openDoor()">開門</button>
            <button class="action-btn door-close" onclick="closeDoor()">關門</button>
        </div>
    </section>

    <!-- 系統日誌 -->
    <section>
        <h2>系統日誌</h2>
        <textarea id="log-display" style="width: 100%; height: 200px; font-family: monospace; resize: vertical;" readonly></textarea>
        <button class="action-btn" onclick="updateLogs()" style="margin-top: 10px; width: 100%;">重新整理日誌</button>
    </section>
</main>

<script>
    function goApprove() {
        window.location.href = 'approve.html';
    }

    // LED 控制
    async function ledOn(index) {
        await fetch('/led/on', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ leds: [index] })
        });
        updateLogs();
    }

    async function ledOff(index) {
        await fetch('/led/off', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ leds: [index] })
        });
        updateLogs();
    }

    // 門控
    async function openDoor() {
        const res = await fetch('/open', { method: 'POST' });
        const data = await res.json();
        alert(data.msg);
        updateLogs();
    }

    async function closeDoor() {
        const res = await fetch('/close', { method: 'POST' });
        const data = await res.json();
        alert(data.msg);
        updateLogs();
    }

    // 更新日誌
    async function updateLogs() {
        try {
            const res = await fetch('/logs');
            const data = await res.json();
            if (data.logs) {
                const logDisplay = document.getElementById('log-display');
                if (logDisplay.value !== data.logs) {
                    logDisplay.value = data.logs;
                    logDisplay.scrollTop = logDisplay.scrollHeight;
                }
            }
        } catch (e) {
            console.error('Failed to update logs:', e);
        }
    }

    // 每秒自動更新日誌
    setInterval(updateLogs, 1000);
    // 初始載入
    updateLogs();

</script>

</body>
</html>